# Dise침o de software Verificable - Proyecto, Entrega 2

## C칩mo correr la aplicaci칩n

Nuestra base de datos MySQL est치 contenerizada dentro de Docker. Para utilizarla, sigue estos pasos:

1. Aseg칰rate de tener Docker instalado en tu sistema.

2. Luego, crea y ejecuta el contenedor de MySQL con el siguiente comando:

```bash
docker compose up
```

Este archivo `compose.yml` define dos servicios: `sii-mysql-db` y `sii-flask-app`. Aqu칤 est치 la explicaci칩n de lo que hace cada uno de ellos:

### Servicio `sii-mysql-db`:
- **Imagen:** Utiliza la imagen oficial de MySQL versi칩n 8.0.
- **Variables de entorno:** Establece las siguientes variables de entorno para la configuraci칩n de MySQL:
  - `MYSQL_ROOT_PASSWORD`: Contrase침a para el usuario root de MySQL.
  - `MYSQL_DATABASE`: Nombre de la base de datos que se crear치 dentro del contenedor.
  - `MYSQL_USER`: Nombre de usuario de MySQL.
  - `MYSQL_PASSWORD`: Contrase침a del usuario de MySQL.
- **Puertos:** Mapea el puerto 3306 del contenedor al puerto 3306 del host, lo que permite que otras aplicaciones se conecten al servidor MySQL.
- **Healthcheck:** Define un comando de verificaci칩n de salud para asegurarse de que el servicio MySQL est칠 en funcionamiento. El healthcheck intenta ejecutar el comando `mysqladmin ping -h localhost` cada 5 segundos y reintentar치 hasta 10 veces si falla.

### Servicio `sii-flask-app`:
- **Construcci칩n de la imagen:** Usa el Dockerfile en el directorio actual (`.`) para construir la imagen del servicio Flask. Esto significa que el Dockerfile debe estar en el mismo directorio que el archivo `compose.yml`.
- **Puertos:** Mapea el puerto 5000 del contenedor al puerto 5000 del host, permitiendo acceder a la aplicaci칩n Flask desde el navegador u otras aplicaciones.
- **Dependencias:** Especifica que este servicio depende del servicio `sii-mysql-db` y se asegura de que el servicio `sii-mysql-db` est칠 en un estado saludable (`service_healthy`) antes de iniciar este servicio. Esto garantiza que la base de datos est칠 disponible antes de que la aplicaci칩n Flask intente conectarse a ella.

Este archivo `compose.yml` proporciona una forma de definir, construir y orquestar m칰ltiples servicios Docker para facilitar el desarrollo y la implementaci칩n de aplicaciones complejas. En este caso, se utiliza para gestionar la base de datos MySQL y la aplicaci칩n Flask de manera conjunta.


## C칩mo probar tabla Multi propietarios
Debido a que nuestro modelo de datos est치 basado en la consistencia de los mismos (nos pareci칩 que podr칤a ser 칰til pensando en el futuro ; quiz치s nos arrepentimos 游봆), se deben realizar m칰ltiples inserciones para poder probar la tabla Multi propietarios. <br><br>Todo los snippets de c칩digo que se ven de aqu칤 en adelante son ejemplos, y sus valores pueden ser modificados con libertad. 
	<br>*Nota: T칠cnicamente se pueden provocar errores con la base de datos al insertar ciertos atributos con libertad absoluta usando la inserci칩n manual mediante la consola de mysql (por ejemplo, ingresando un RUT/RUN m치s largo del esperado). Ya que los usuarios no pueden ingresar formularios de esta manera, no pensamos que el cliente se preocupe de este tipo de errores.*<br>
Ahora s칤, veamos los pasos a seguir para insertar datos en la tabla Multi propietario.<br>
### 1. Personas
Primero que nada, necesitamos crear las personas que ser치n due침as de la propiedad/bien ra칤z. <br>
	`INSERT INTO persona (rut) VALUES ('12345678-9'), ('18765432-1'), ('5498732-1');` 
<br>La tabla persona aceptar치 los ruts con puntos entremedio (ej: 12.345.678-9), pero s칩lo mediante el ingreso manual de los datos mediante la consola de MySQL; en cualquier otro caso, se descartar치,. Es decir, que al usar la aplicaci칩n, se espera que los ruts se ingresen sin puntos entremedio.
### 2. Bien ra칤z
Luego, debemos crear el bien ra칤z en cuesti칩n.<br>
`INSERT INTO bien_raiz (comuna, manzana, predio, rol) VALUES (1,1,1 "1,1,1");`

### 3. Multi propietario
Ahora es momento de ingresar filas a la tabla multi propietario, que junta al concepto de propiedad con un rol determinado.

	`INSERT INTO multipropietario(
		id, rol, fojas, fecha_inscripcion, numero_inscripcion, ano_inscripcion,
		ano_vigencia_inicial, ano_vigencia_final
	) 
	VALUES 
		(1, "1-1-1", 10, '2023-05-15', 1001, 1900, 2023, 2028), 
		(2, "1-1-1", 25, '2023-05-15', 1001, 1900, 2020, 2028), 
		(3, "1-1-1", 40, '2023-05-15', 1001, 1900, 2000, 2030);`

Donde el 'rol' debe ser de la propiedad ingresada anteriormente:
	`SELECT * FROM bien_raiz WHERE manzana=1 AND predio=1 AND comuna=1

Notar c칩mo ingresamos el atributo 'id' manualmente. Esto es porque nos facilitar치 su uso en el paso siguiente (nada m치s, hay que tener cuidado con no ingresar un 'id' que hayamos ingresado previamente).
### 4. Propietario
Finalmente, ingresamos filas a la tabla Propietario, la cu치l se encarga de unir a las personas propietarias con sus propiedades (es una tabla intermedia ; relaci칩n N x N). 

	`INSERT INTO propietario (rut, multipropietario_id, porcentaje_derecho) VALUES  ('5498732-1', 3, 25), ('12345678-9', 1, 25),  ('18765432-1', 2, 50);`

Donde el 'rut' deben ser los mismos que fueron ingresados durante el paso 1, y los multipropietario_id los mismo que ingresamos en el paso 3.




## Tests

Para correr los tests, primero debes instalar las dependencias necesarias. Puedes hacerlo ejecutando el siguiente comando:

```bash
pip install -r requirements.txt
```

Una vez instaladas las dependencias, puedes ejecutar los tests con el siguiente comando:

```bash
coverage run -m unittest discover
```

Este comando ejecutar치 todos los tests unitarios definidos en el directorio `tests` y generar치 un reporte de cobertura. Para ver el reporte de cobertura, puedes ejecutar el siguiente comando:

```bash
coverage report
```

